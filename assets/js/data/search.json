[
  
  {
    "title": "Explore OpenWrt on Emulated hardware",
    "url": "/posts/explore-openwrt-on-emulated-hardware/",
    "categories": "blog, tutorial",
    "tags": "openwrt, qemu, armsr, wireless, routers",
    "date": "2025-03-17 10:00:00 +0530",
    





    
    "snippet": "OpenWrt - An overviewOpenWrt (Open Wireless RouTer) is an open-source project for creating anembedded operating systems based on Linux. OpenWrt is designed for embeddeddevices, particularly routers...",
    "content": "OpenWrt - An overviewOpenWrt (Open Wireless RouTer) is an open-source project for creating anembedded operating systems based on Linux. OpenWrt is designed for embeddeddevices, particularly routers and is capable to run in range of hardware products,be it low memory Wi-Fi routers, CPE routers, residential gateways, access pointsand so on. In this article, the possibilities of booting up arouter operating system like OpenWrt without a physical hardware is unravelled.Features of OpenWrtBelow are the few key features of OpenWrtConfiguration over command line interface (or) web interface(LuCI)CustomizationPerformance and StabilityAdvanced Networking Features like firewall, VLAN, VPN, QoS and so onEnhanced SecurityMesh NetworkingPackage Management using opkg/apkg package managerUnleash OpenWrt on non-physical hardwareWhile OpenWrt is primarily designed for embedded devices like routers, it&#8217;s notstrictly limited to real hardware and can also be run in virtual machines (VMs),emulator, or on x86 hardware. OpenWrt provides QEMU packages for ARM and x86platforms to explore the OS without the need of real hardware&#8217;s using emulators.QEMU (Quick EMUlator) is a powerful, open-source processor emulator andvirtualizer. QEMU can emulate various CPU architectures (like x86, ARM and soon) and hardware devices allowing you to run software and operating systemsdesigned for those architectures on your current system.This articles helps us to emulate OpenWrt using qemu in Arm SystemReady targetArm SystemReadyArm SystemReady (or) armsr is an openwrt target that is developed based onArmSystemReady compliance program where an Operating System image will becompatible across ARM based hardware manufacturers.Arm SystemReady is implemented in alignment with the two OS environment andfirmware approaches commonly used to generate and install the OS Images. Theseare split into the following bandsSystemReady bandSystemReady Devicetree bandOpenWrt uses the SystemReady Devicetree band, where the preferred method ofbooting the OS is based on the hardware devicetree.Arm SystemReady on OpenWrtarmsr takes over from the previous armvirt target in OpenWrt and addssupport for Arm systems that support booting EFI images. armsr supports the belowsubtargetsarmv7 for 32-bit machinesarmv8 for 64-bit machinesQEMU can be used to emulate armsr target running OpenWrt without the needs forreal hardware.Refer OpenWrt Target &#8594; armsr &#8594; READMEto get the detailed instructions on how to boot the OpenWrt SystemReady image.Running OpenWrt using qemuFor Running OpenWrt on QEMU, we can use armsr-armv8 as a reference target to bootand analyse OpenWrt OS.Prebuilt Images are available and can be downloaded from the OpenWrt&#8217;s Snapshotdownloads for armsr-armv8.Download the below image files from the OpenWrt link for emulating armsr targetusing qemu.openwrt-armsr-armv8-generic-squashfs-combined-efi.img.gzu-boot-qemu_armv8/u-boot.binDecompress the generic-squashfs-combined-efi.img.gz into openwrt-arm-64.imggunzip -c openwrt-armsr-armv8-generic-squashfs-combined-efi.img.gz &gt; openwrt-arm-64.imgEmulate OpenWrt for armsr-armv8 target using qemu-system-aarch64 command withthe default arguments for kernel, rootfs image, cpu and network options.qemu-system-aarch64 -nographic \\    -cpu cortex-a53 -machine virt \\    -bios u-boot.bin \\    -smp 1 -m 1024 \\    -device virtio-rng-pci \\    -drive file=openwrt-arm-64.img,format=raw,index=0,media=disk \\    -netdev user,id=testlan -net nic,netdev=testlan \\    -netdev user,id=testwan -net nic,netdev=testwanWalkthrough OpenWrt bootlog for armsr-armv8OpenWrt is successfully booted for armsr-armv8 target.Below excerpt from the OpenWrt bootlog, covers the following stages of booting,Booting : U-BootBooting : Linux kernel with version Linux version 6.6.83OpenWrt promptU-Boot 2023.04-OpenWrt-r29028-adc4d95c74 (Mar 16 2025 - 21:43:02 +0000)DRAM:  1 GiBCore:  51 devices, 14 uclasses, devicetree: boardFlash: 64 MiBLoading Environment from Flash... *** Warning - bad CRC, using default environmentIn:    pl011@9000000Out:   pl011@9000000Err:   pl011@9000000Net:   eth0: virtio-net#32, eth1: virtio-net#33Hit any key to stop autoboot:  0.... skipped ....EFI stub: Booting Linux Kernel...EFI stub: Using DTB from configuration tableEFI stub: Exiting boot services...[    0.000000] Booting Linux on physical CPU 0x0000000000 [0x410fd034][    0.000000] Linux version 6.6.83 (builder@buildhost) (aarch64-openwrt-linux-musl-gcc (OpenWrt GCC 13.3.0 r29028-adc4d95c74) 13.3.0, GNU ld (GNU Binutils) 2.42) #0 SMP Sun Mar 16 21:43:02 2025[    0.000000] KASLR enabled[    0.000000] Machine model: linux,dummy-virt.... skipped ....[    0.004525] printk: console [tty1] enabled[    0.004786] printk: bootconsole [pl11] disabledPlease press Enter to activate this console.BusyBox v1.37.0 (2025-03-16 21:43:02 UTC) built-in shell (ash)  _______                     ________        __ |       |.-----.-----.-----.|  |  |  |.----.|  |_ |   -   ||  _  |  -__|     ||  |  |  ||   _||   _| |_______||   __|_____|__|__||________||__|  |____|          |__| W I R E L E S S   F R E E D O M ----------------------------------------------------- OpenWrt SNAPSHOT, r29028-adc4d95c74 -----------------------------------------------------=== WARNING! =====================================There is no root password defined on this device!Use the \"passwd\" command to set up a new passwordin order to prevent unauthorized SSH logins. -----------------------------------------------------root@OpenWrt:~#OpenWrt version and board detailsThe openwrt version and board_name related details from the ARMSR system,root@OpenWrt:~# cat /etc/openwrt_releaseDISTRIB_ID='OpenWrt'DISTRIB_RELEASE='SNAPSHOT'DISTRIB_REVISION='r29028-adc4d95c74'DISTRIB_TARGET='armsr/armv8'DISTRIB_ARCH='aarch64_generic'DISTRIB_DESCRIPTION='OpenWrt SNAPSHOT r29028-adc4d95c74'DISTRIB_TAINTS=''root@OpenWrt:~#root@OpenWrt:~# cat /etc/openwrt_versionr29028-adc4d95c74root@OpenWrt:~#root@OpenWrt:~#root@OpenWrt:~# cat /tmp/sysinfo/board_namelinux,dummy-virtEthernetIP Address is assigned to the WAN Interface of the Target device.And Target device could able to reach Internet through WAN Network.root@OpenWrt:~# ifconfig eth1eth1      Link encap:Ethernet  HWaddr 52:54:00:12:34:57          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0          inet6 addr: fec0::5054:ff:fe12:3457/64 Scope:Site          inet6 addr: fe80::5054:ff:fe12:3457/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:184 errors:0 dropped:0 overruns:0 frame:0          TX packets:229 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000          RX bytes:17075 (16.6 KiB)  TX bytes:22998 (22.4 KiB)root@OpenWrt:~# ping 8.8.8.8PING 8.8.8.8 (8.8.8.8): 56 data bytes64 bytes from 8.8.8.8: seq=0 ttl=255 time=8.390 ms.... skipped ....root@OpenWrt:~# ping -c 3 google.comPING google.com (142.250.196.78): 56 data bytes64 bytes from 142.250.196.78: seq=0 ttl=255 time=5.849 ms64 bytes from 142.250.196.78: seq=1 ttl=255 time=8.664 ms64 bytes from 142.250.196.78: seq=2 ttl=255 time=8.852 ms--- google.com ping statistics ---3 packets transmitted, 3 packets received, 0% packet lossround-trip min/avg/max = 5.849/7.788/8.852 msA New OpenWrt BeginningWith OpenWrt running on qemu, It opens up a way to explore OpenWrt without realhardware and allows for endless option to tweak and tune your experiments.Referenceshttps://www.qemu.org/docs/master/system/target-arm.htmlhttps://openwrt.org/docs/guide-user/virtualization/qemuhttps://github.com/ARM-software/arm-systemreadyhttps://community.arm.com/arm-community-blogs/b/architectures-and-processors-blog/posts/arm-systemready"
  },
  
  {
    "title": "Build your own OpenWrt firmware for IPQ devices",
    "url": "/posts/build-openwrt-for-ipq-devices/",
    "categories": "blog, tutorial",
    "tags": "openwrt, feed-ipq, wireless, routers",
    "date": "2025-03-13 10:00:00 +0530",
    





    
    "snippet": "OpenWrt - An overviewOpenWrt is a Linux based Open-source Operating system which are primarily usedon wireless routers and mesh devices. For users, OpenWrt means the freedom offull customization, a...",
    "content": "OpenWrt - An overviewOpenWrt is a Linux based Open-source Operating system which are primarily usedon wireless routers and mesh devices. For users, OpenWrt means the freedom offull customization, allowing the use of an embedded device in ways the vendornever envisioned. Designed to be lightweight and efficient, OpenWrt is capableto run in range of hardware products, be it low memory Wi-Fi routers, CPE routers andso on.OpenWrt supports a wide range of System-on-Chip (SoC) vendors including but notlimited to Airoha, Broadcom, MediaTek, Qualcomm, Realtek. SoC vendor prefersOpenWrt based Operating System for their Wireless Routers, since it providesVarious customization, Package management, Better Security features and a greatCommunity support.For Wireless chipsets in the routers, OpenWrt uses upstream/open-source versionof network drivers and packages for their respective chipsets which are freelyavailable and published into the open-source community.Along with open-source contributions, SoC Vendors focus on developing the latestfeatures, Enhancements and Bug fixes. While most of the features are publishedto the open-source community, Vendor specific features will be available only inthrough their External release repos until the packages and patches areupstreamed to the community.Qualcomm Internet Processor (IPQ) in Wi-Fi Product lineQualcomm is one of the leading SoC vendors for most of the wireless routers.Qualcomm Internet Processor (IPQ) refers to a series of System-on-Chip (SoC)designed specifically for Wi-Fi networking devices like routers, gateways andaccess points. IPQ807X, IPQ95XX and IPQ53XX are few of the latest Qualcomm SoC&#8217;sseries available in the market and are utilized in the various enterprise,retail and carrier broadband products.Qualcomm Wi-Fi chipset details are available in the Wiki Page.Qualcomm provides releases to the Customer and open-source community for IPQdevices through Codelinaro website, whose source code can be downloaded basedon the details here.feed-ipq : Collection of package recipes for IPQ devicesfeed-ipq is an OpenWrt feed repository which helps to build latest OpenWrtfirmware for Qualcomm Wi-Fi SoC platforms (IPQ Devices), which is on-par withthe latest release from Qualcomm. This feed can be easily integrated intoOpenWrt and OpenWrt based build systems like prplOS, IOWRT and openWiFi.feed-ipq is available at, https://github.com/zilogic-systems/feed-ipqfeed-ipq is intended to be layered on-top of an OpenWrt providing only therequired packages and files relevant for bring-up of the networking and Wi-Fifeatures in the IPQ devices. This repository contains OpenWrt Target directoryfiles for IPQ devices, Network, Wi-Fi drivers, packages and scripts.These can be used along with other feeds of OpenWrt.Directory structure.|-- feeds|   |-- clo-upstream|   |-- nss-host|   |-- platform_utils|   |-- ssdk|   `-- wlan_utils|-- README.md`-- targets    `-- ipq95xxDirectory structure of the feed-ipq is segregated based on the followingtargets - contains IPQ targets like ipq95xx and target related configs, files and patchesfeeds   - contains IPQ target specific drivers, packages and scriptsfeeds/clo-upstream - contains OpenWrt upstream components which are customized for IPQ targetsBuild OpenWrt using feed-ipq for IPQ targetsOpenWrt repo initializationClone the OpenWrt repository using the commandgit clone https://github.com/openwrt/openwrt.gitcd openwrtCheckout to OpenWrt Latest Stable Release - v24.10.0git checkout v24.10.0Configure feed-ipq repo in feeds.conf.defaultAppend the below line into OpenWrt&#8217;s feeds.conf.default to add and configurefeed-ipq repo into the buildsrc-git feed_ipq https://github.com/zilogic-systems/feed-ipq.git^23e8cddafd7d21810288024ef5de137447646fc6Update the latest commit_hash in feeds.conf.default to fetch updated commits infeed-ipq repo.Bump Kernel version for IPQ targetsBased on clo release, Kernel version needs to be updated for IPQ targetsUpdate the below Kernel version related details in include/kernel-6.6LINUX_VERSION-6.6 = .47LINUX_KERNEL_HASH-6.6.47 = d43376c9e9eaa92bb1b926054bd160d329c58a62d64bd65fe1222c11c6564f50Update &amp; Install feedsRun ./scripts/feeds update -a to obtain all the latest package definitionsdefined in feeds.conf / feeds.conf.defaultRun ./scripts/feeds install -a to install symlinks for all obtainedpackages into package/feeds/Install IPQ targets from feed-ipqInstall IPQ targets from feed_ipq directory using the command./scripts/feeds install ipq95xxAbove command will create a symlink of target between feeds/feed_ipq/targets/ipq95xx and target/linux/feeds/ipq95xx directoryConfigure Build Target profileSelect and save ipq95xx target profile using the make menuconfig command in the below sequence1. Target System  -&gt; Qualcomm Technologies, Inc. IPQ95XX2. Subtarget      -&gt; (QTI IPQ95xx(64bit) based boards)3. Target Profile -&gt; Qualcomm IPQ9574-RDP4334. Save -&gt; .config5. Exit -&gt; YesTrigger OpenWrt buildExecute the below command to trigger the OpenWrt buildmake V=e -j$(nproc)Build ArtifactsList of OpenWrt Firmware Images generated for IPQ devicesKernel_Image - build_dir/target-aarch64_cortex-a73+neon-vfpv4_musl/linux-ipq95xx_generic/qcom_rdp433-uImage.itbRootfs_Image - build_dir/target-aarch64_cortex-a73+neon-vfpv4_musl/linux-ipq95xx_generic/root.squashfsFlashing Instructions for IPQ devicesGeneric Flashing InstructionsIn U-Boot prompt, Download the Firmware Image which needs to be flashed into the Targettftpb &lt;file_name&gt;Once the Image is downloaded, Flash the image into the respective partitionflash &lt;partition_name&gt;Flashing in eMMC boardsExecute the below set of commands to flash kernel and rootfs image into IPQ emmc flash variant boardstftpb &lt;Kernel_Image&gt; &amp;&amp; flash 0:HLOStftpb &lt;Rootfs_Image&gt; &amp;&amp; flash rootfsFlashing in NAND BoardsExecute the below set of commands to flash kernel and rootfs image into IPQ nand flash variant boardstftpb &lt;Kernel_Image&gt; &amp;&amp; flash kerneltftpb &lt;Rootfs_Image&gt; &amp;&amp; flash ubi_rootfsVerification of the built ImageIn the generated OpenWRT Image, We could able to validate the below featuresOpenWrt version - 24.10.0GCC version     - GCC 13.3.0 r28427-6df0e3d02aEthernet - WANEthernet - LANWiFi Interface up and runningWiFi Client connectivity - 2GWiFi Client connectivity - 5GPing from AP to 2G clientPing from AP to 5G clientSpeed test in 2G clientSpeed test in 5G clientEthernetIP Address is assigned to the WAN Interface of the Target device.And Target device could able to reach Internet through WAN Network.root@OpenWrt:~# ifconfig eth0eth0      Link encap:Ethernet  HWaddr 00:03:7F:E6:D1:5E          inet addr:172.16.1.7  Bcast:172.16.255.255  Mask:255.255.0.0          inet6 addr: fd78:4c15:7f9d:0:203:7fff:fee6:d15e/64 Scope:Global          inet6 addr: 2a02:1234:420a:100b:203:7fff:fee6:d15e/64 Scope:Global          inet6 addr: fe80::203:7fff:fee6:d15e/64 Scope:Link          inet6 addr: fd78:4c15:7f9d::8f8/128 Scope:Global          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:1420 errors:0 dropped:390 overruns:0 frame:0          TX packets:45 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000          RX bytes:259546 (253.4 KiB)  TX bytes:5318 (5.1 KiB)          Base address:0x1000root@OpenWrt:~#root@OpenWrt:~# ping -c 5 8.8.8.8PING 8.8.8.8 (8.8.8.8): 56 data bytes64 bytes from 8.8.8.8: seq=0 ttl=118 time=1.454 ms64 bytes from 8.8.8.8: seq=1 ttl=118 time=1.293 ms64 bytes from 8.8.8.8: seq=2 ttl=118 time=1.403 ms64 bytes from 8.8.8.8: seq=3 ttl=118 time=1.261 ms64 bytes from 8.8.8.8: seq=4 ttl=118 time=1.244 ms--- 8.8.8.8 ping statistics ---5 packets transmitted, 5 packets received, 0% packet lossround-trip min/avg/max = 1.244/1.331/1.454 msroot@OpenWrt:~#root@OpenWrt:~# ping -c 5 google.comPING google.com (142.250.71.14): 56 data bytes64 bytes from 142.250.71.14: seq=0 ttl=118 time=1.356 ms64 bytes from 142.250.71.14: seq=1 ttl=118 time=1.395 ms64 bytes from 142.250.71.14: seq=2 ttl=118 time=1.216 ms64 bytes from 142.250.71.14: seq=3 ttl=118 time=1.214 ms64 bytes from 142.250.71.14: seq=4 ttl=118 time=1.225 ms--- google.com ping statistics ---5 packets transmitted, 5 packets received, 0% packet lossround-trip min/avg/max = 1.214/1.281/1.395 msWiFiWiFi Interfaces for all the Radios are up and running.root@OpenWrt:~# iw devphy#0        Interface wlan0                ifindex 13                wdev 0x4                addr 00:03:7f:12:1b:1b                ssid feed-ipq-2g                type AP                Power mode: 0                link 0:                  addr 00:03:7f:12:1b:1b                  channel 6 (2437 MHz), width: 20 MHz, center1: 2437 MHz                  txpower 29.00 dBm        Interface wlan2                ifindex 12                wdev 0x3                addr 00:03:7f:12:1d:1d                ssid feed-ipq-6g                type AP                Power mode: 0                link 0:                  addr 00:03:7f:12:1d:1d                  channel 49 (6195 MHz), width: 80 MHz, center1: 6225 MHz                  txpower 21.00 dBm        Interface wlan1                ifindex 11                wdev 0x2                addr 00:03:7f:12:1c:1c                ssid feed-ipq-5g                type AP                Power mode: 0                link 0:                  addr 00:03:7f:12:1c:1c                  channel 36 (5180 MHz), width: 80 MHz, center1: 5210 MHz                  txpower 28.00 dBmVerified WiFi Clients connectivity to 2G and 5G Radios.root@OpenWrt:~# iwinfo wlan0 assoc32:FF:B0:0E:1A:91  -55 dBm / -106 dBm (SNR 51)  10880 ms ago        RX: 172.0 MBit/s, HE-MCS 7, 20MHz, HE-NSS 2, HE-GI 0, HE-DCM 0       139 Pkts.        TX: 1.0 MBit/s                                   110 Pkts.        expected throughput: unknownroot@OpenWrt:~#root@OpenWrt:~# iwinfo wlan1 assocFA:30:3B:77:11:84  -49 dBm / -106 dBm (SNR 57)  5950 ms ago        RX: 1200.9 MBit/s, HE-MCS 11, 80MHz, HE-NSS 2, HE-GI 0, HE-DCM 0      2350 Pkts.        TX: 432.3 MBit/s, HE-MCS 4, 80MHz, HE-NSS 2, HE-GI 0, HE-DCM 0      6169 Pkts.        expected throughput: unknownReferenceshttps://openwrt.org/https://openwrt.org/docs/guide-developer/feedshttps://github.com/zilogic-systems/feed-ipq/blob/ath.13.0/README.md"
  }
  
]

